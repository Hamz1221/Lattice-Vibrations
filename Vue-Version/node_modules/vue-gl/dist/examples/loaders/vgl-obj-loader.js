!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("three"),require("three")):"function"==typeof define&&define.amd?define(["three","three"],t):((e=e||self).VueGL=e.VueGL||{},e.VueGL.VglObjLoader=t(e.THREE,e.THREE))}(this,(function(e,t){"use strict";var r=function(e,t,r){this.supportsStandardWorker=e,this.supportsJsmWorker=t,this.preferJsmWorker=r,this.startCode="",this.codeFragments=[],this.importStatements=[],this.jsmWorkerUrl=null,this.defaultGeometryType=0};r.prototype={constructor:r,isSupportsStandardWorker:function(){return this.supportsStandardWorker},isSupportsJsmWorker:function(){return this.supportsJsmWorker},isPreferJsmWorker:function(){return this.preferJsmWorker},setJsmWorkerUrl:function(e){null!=e&&(this.jsmWorkerUrl=e)},addStartCode:function(e){this.startCode=e},addCodeFragment:function(e){this.codeFragments.push(e)},addLibraryImport:function(e){var t='importScripts( "'+new URL(e,window.location.href).href+'" );';this.importStatements.push(t)},getImportStatements:function(){return this.importStatements},getCodeFragments:function(){return this.codeFragments},getStartCode:function(){return this.startCode}};var s=function(){if(void 0===window.Worker)throw"This browser does not support web workers!";if(void 0===window.Blob)throw"This browser does not support Blob!";if("function"!=typeof window.URL.createObjectURL)throw"This browser does not support Object creation from URL!";this._reset()};function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function l(e,t,r){return(l=a()?Reflect.construct:function(e,t,r){var s=[null];s.push.apply(s,t);var n=new(Function.bind.apply(e,s));return r&&i(n,r.prototype),n}).apply(null,arguments)}function u(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||c(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){if(e){if("string"==typeof e)return h(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(e,t):void 0}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,s=new Array(t);r<t;r++)s[r]=e[r];return s}s.WORKER_SUPPORT_VERSION="3.2.0",console.info("Using WorkerSupport version: "+s.WORKER_SUPPORT_VERSION),s.prototype={constructor:s,_reset:function(){this.logging={enabled:!1,debug:!1};var e=this;this.worker={native:null,jsmWorker:!1,logging:!0,workerRunner:{name:"WorkerRunner",usesMeshDisassembler:!1,defaultGeometryType:0},terminateWorkerOnLoad:!0,forceWorkerDataCopy:!1,started:!1,queuedMessage:null,callbacks:{onAssetAvailable:null,onLoad:null,terminate:function(){e._terminate()}}}},setLogging:function(e,t){return this.logging.enabled=!0===e,this.logging.debug=!0===t,this.worker.logging=!0===e,this},setForceWorkerDataCopy:function(e){return this.worker.forceWorkerDataCopy=!0===e,this},setTerminateWorkerOnLoad:function(e){return this.worker.terminateWorkerOnLoad=!0===e,this.worker.terminateWorkerOnLoad&&this.isWorkerLoaded(this.worker.jsmWorker)&&null===this.worker.queuedMessage&&this.worker.started&&(this.logging.enabled&&console.info("Worker is terminated immediately as it is not running!"),this._terminate()),this},updateCallbacks:function(e,t){null!=e&&(this.worker.callbacks.onAssetAvailable=e),null!=t&&(this.worker.callbacks.onLoad=t),this._verifyCallbacks()},_verifyCallbacks:function(){if(void 0===this.worker.callbacks.onAssetAvailable||null===this.worker.callbacks.onAssetAvailable)throw'Unable to run as no "onAssetAvailable" callback is set.'},buildWorker:function(e){var t=!1;e.isSupportsJsmWorker()&&e.isPreferJsmWorker()&&(t=this._buildWorkerJsm(e)),!t&&e.isSupportsStandardWorker()&&this._buildWorkerStandard(e)},_buildWorkerJsm:function(e){var t=!0;if(!this._buildWorkerCheckPreconditions(!0,"buildWorkerJsm"))try{var r=new Worker(e.jsmWorkerUrl.href,{type:"module"});this._configureWorkerCommunication(r,!0,e.defaultGeometryType,"buildWorkerJsm")}catch(e){t=!1,(e instanceof TypeError||e instanceof SyntaxError)&&console.error("Modules are not supported in workers.")}return t},_buildWorkerStandard:function(e){if(!this._buildWorkerCheckPreconditions(!1,"buildWorkerStandard")){var t="";e.getImportStatements().forEach((function(e){t+=e+"\n"})),t+="\n",e.getCodeFragments().forEach((function(e){t+=e+"\n"})),t+="\n",t+=e.getStartCode();var r=new Blob([t],{type:"application/javascript"}),s=new Worker(window.URL.createObjectURL(r));this._configureWorkerCommunication(s,!1,e.defaultGeometryType,"buildWorkerStandard")}},_buildWorkerCheckPreconditions:function(e,t){var r=!1;return this.isWorkerLoaded(e)?r=!0:this.logging.enabled&&(console.info("WorkerExecutionSupport: Building "+(e?"jsm":"standard")+" worker code..."),console.time(t)),r},_configureWorkerCommunication:function(e,t,r,s){this.worker.native=e,this.worker.jsmWorker=t;var n=this,o=function(e){n._receiveWorkerMessage(e)};this.worker.native.onmessage=o,this.worker.native.onerror=o,null!=r&&(this.worker.workerRunner.defaultGeometryType=r),this.logging.enabled&&console.timeEnd(s)},isWorkerLoaded:function(e){return null!==this.worker.native&&(e&&this.worker.jsmWorker||!e&&!this.worker.jsmWorker)},_receiveWorkerMessage:function(e){if("error"!==e.type){var t=e.data,r=this.worker.workerRunner.name;switch(t.cmd){case"assetAvailable":this.worker.callbacks.onAssetAvailable(t);break;case"completeOverall":this.worker.queuedMessage=null,this.worker.started=!1,null!==this.worker.callbacks.onLoad&&this.worker.callbacks.onLoad(t.msg),this.worker.terminateWorkerOnLoad&&(this.worker.logging.enabled&&console.info("WorkerSupport ["+r+"]: Run is complete. Terminating application on request!"),this.worker.callbacks.terminate());break;case"error":console.error("WorkerSupport ["+r+"]: Reported error: "+t.msg),this.worker.queuedMessage=null,this.worker.started=!1,null!==this.worker.callbacks.onLoad&&this.worker.callbacks.onLoad(t.msg),this.worker.terminateWorkerOnLoad&&(this.worker.logging.enabled&&console.info("WorkerSupport ["+r+"]: Run reported error. Terminating application on request!"),this.worker.callbacks.terminate());break;default:console.error("WorkerSupport ["+r+"]: Received unknown command: "+t.cmd)}}else console.error(e)},executeParallel:function(e,t){e.cmd="parse",e.usesMeshDisassembler=this.worker.workerRunner.usesMeshDisassembler,e.defaultGeometryType=this.worker.workerRunner.defaultGeometryType,this._verifyWorkerIsAvailable(e,t)&&this._postMessage()},_verifyWorkerIsAvailable:function(e,t){this._verifyCallbacks();var r=!0;return null!==this.worker.queuedMessage?(console.warn("Already processing message. Rejecting new run instruction"),r=!1):(this.worker.queuedMessage={payload:e,transferables:null==t?[]:t},this.worker.started=!0),r},_postMessage:function(){if(null!==this.worker.queuedMessage)if(this.worker.queuedMessage.payload.data.input instanceof ArrayBuffer){var e=[];this.worker.forceWorkerDataCopy?e.push(this.worker.queuedMessage.payload.data.input.slice(0)):e.push(this.worker.queuedMessage.payload.data.input),this.worker.queuedMessage.transferables.length>0&&(e=e.concat(this.worker.queuedMessage.transferables)),this.worker.native.postMessage(this.worker.queuedMessage.payload,e)}else this.worker.native.postMessage(this.worker.queuedMessage.payload)},_terminate:function(){this.worker.native.terminate(),this._reset()}};var d=function(e,t,r,s){var o,i,a,l,u,c=t.constructor.name,h=[],d=[],p=[],m=null!=r;for(var f in Array.isArray(s)||(s=[]),e.prototype)o=e.prototype[f],(l=new g(f,c+".prototype."+f)).setCode(o.toString()),"constructor"===f?l.isRemoveCode()||(i=c+" = "+l.getCode()+";\n\n"):"function"==typeof o&&((u=s[f])instanceof g&&u.getName()===l.getName()&&(l=u),l.isRemoveCode()||(m?h.push(l.getFullName()+" = "+l.getCode()+";\n\n"):h.push("\t"+l.getName()+": "+l.getCode()+",\n\n")));for(var b in e)o=e[b],l=new g(b,c+"."+b),"function"==typeof o?((u=s[b])instanceof g&&u.getName()===l.getName()?l=u:l.setCode(o.toString()),l.isRemoveCode()||p.push(l.getFullName()+" = "+l.getCode()+";\n\n")):("string"==typeof o||o instanceof String?l.setCode('"'+o.toString()+'"'):"object"===n(o)?(console.log('Omitting object "'+l.getName()+'" and replace it with empty object.'),l.setCode("{}")):l.setCode(o),l.isRemoveCode()||d.push(l.getFullName()+" = "+l.getCode()+";\n"));var v=i+"\n\n";for(m&&(v+=c+".prototype = Object.create( "+r+".prototype );\n"),v+=c+".prototype.constructor = "+c+";\n",v+="\n\n",a=0;a<d.length;a++)v+=d[a];for(v+="\n\n",a=0;a<p.length;a++)v+=p[a];if(v+="\n\n",m)for(a=0;a<h.length;a++)v+=h[a];else{for(v+=c+".prototype = {\n\n",a=0;a<h.length;a++)v+=h[a];v+="\n};"}return v+="\n\n"},g=function(e,t){this.name=e,this.fullName=t,this.code=null,this.removeCode=!1};g.prototype={constructor:g,getName:function(){return this.name},getFullName:function(){return this.fullName},setCode:function(e){return this.code=e,this},getCode:function(){return this.code},setRemoveCode:function(e){return this.removeCode=e,this},isRemoveCode:function(){return this.removeCode}};var p=function(){this.logging={enabled:!1,debug:!1};var e=this;this.callbacks={onProgress:function(t){e._onProgress(t)},onAssetAvailable:function(t){e._onAssetAvailable(t)},onError:function(t){e._onError(t)},onLoad:function(t,r){e._onLoad(t,r)}},this.contentRef=null,this.legacyMode=!1,this.materials={},this.materialPerSmoothingGroup=!1,this.useOAsMesh=!1,this.useIndices=!1,this.disregardNormals=!1,this.vertices=[],this.colors=[],this.normals=[],this.uvs=[],this.rawMesh={objectName:"",groupName:"",activeMtlName:"",mtllibName:"",faceType:-1,subGroups:[],subGroupInUse:null,smoothingGroup:{splitMaterials:!1,normalized:-1,real:-1},counts:{doubleIndicesCount:0,faceCount:0,mtlCount:0,smoothingGroupCount:0}},this.inputObjectCount=1,this.outputObjectCount=1,this.globalCounts={vertices:0,faces:0,doubleIndicesCount:0,lineByte:0,currentByte:0,totalBytes:0}};p.prototype={constructor:p,_resetRawMesh:function(){this.rawMesh.subGroups=[],this.rawMesh.subGroupInUse=null,this.rawMesh.smoothingGroup.normalized=-1,this.rawMesh.smoothingGroup.real=-1,this._pushSmoothingGroup(1),this.rawMesh.counts.doubleIndicesCount=0,this.rawMesh.counts.faceCount=0,this.rawMesh.counts.mtlCount=0,this.rawMesh.counts.smoothingGroupCount=0},setMaterialPerSmoothingGroup:function(e){return this.materialPerSmoothingGroup=!0===e,this},setUseOAsMesh:function(e){return this.useOAsMesh=!0===e,this},setUseIndices:function(e){return this.useIndices=!0===e,this},setDisregardNormals:function(e){return this.disregardNormals=!0===e,this},setMaterials:function(e){this.materials=Object.assign({},e)},setCallbackOnAssetAvailable:function(e){return null!=e&&e instanceof Function&&(this.callbacks.onAssetAvailable=e),this},setCallbackOnProgress:function(e){return null!=e&&e instanceof Function&&(this.callbacks.onProgress=e),this},setCallbackOnError:function(e){return null!=e&&e instanceof Function&&(this.callbacks.onError=e),this},setCallbackOnLoad:function(e){return null!=e&&e instanceof Function&&(this.callbacks.onLoad=e),this},_onProgress:function(e){var t=e||"";this.logging.enabled&&this.logging.debug&&console.log(t)},_onError:function(e){this.logging.enabled&&this.logging.debug&&console.error(e)},_onAssetAvailable:function(e){var t="OBJLoader2Parser does not provide implementation for onAssetAvailable. Aborting...";throw this.callbacks.onError(t),t},_onLoad:function(e,t){console.log("You reached parser default onLoad callback: "+t)},setLogging:function(e,t){return this.logging.enabled=!0===e,this.logging.debug=!0===t,this},_configure:function(){if(this._pushSmoothingGroup(1),this.logging.enabled){var e=Object.keys(this.materials),t="OBJLoader.Parser configuration:"+(e.length>0?"\n\tmaterialNames:\n\t\t- "+e.join("\n\t\t- "):"\n\tmaterialNames: None")+"\n\tmaterialPerSmoothingGroup: "+this.materialPerSmoothingGroup+"\n\tuseOAsMesh: "+this.useOAsMesh+"\n\tuseIndices: "+this.useIndices+"\n\tdisregardNormals: "+this.disregardNormals;t+="\n\tcallbacks.onProgress: "+this.callbacks.onProgress.name,t+="\n\tcallbacks.onAssetAvailable: "+this.callbacks.onAssetAvailable.name,t+="\n\tcallbacks.onError: "+this.callbacks.onError.name,console.info(t)}},execute:function(e){this.logging.enabled&&console.time("OBJLoader2Parser.execute"),this._configure();var t=new Uint8Array(e);this.contentRef=t;var r=t.byteLength;this.globalCounts.totalBytes=r;for(var s,n=new Array(128),o=0,i=0,a="",l=0;l<r;l++)switch(s=t[l]){case 32:a.length>0&&(n[o++]=a),a="";break;case 47:a.length>0&&(n[o++]=a),i++,a="";break;case 10:this._processLine(n,o,i,a,l),a="",o=0,i=0;break;case 13:break;default:a+=String.fromCharCode(s)}this._processLine(n,o,i,a,0),this._finalizeParsing(),this.logging.enabled&&console.timeEnd("OBJLoader2Parser.execute")},executeLegacy:function(e){this.logging.enabled&&console.time("OBJLoader2Parser.executeLegacy"),this._configure(),this.legacyMode=!0,this.contentRef=e;var t=e.length;this.globalCounts.totalBytes=t;for(var r,s=new Array(128),n=0,o=0,i="",a=0;a<t;a++)switch(r=e[a]){case" ":i.length>0&&(s[n++]=i),i="";break;case"/":i.length>0&&(s[n++]=i),o++,i="";break;case"\n":this._processLine(s,n,o,i,a),i="",n=0,o=0;break;case"\r":break;default:i+=r}this._processLine(s,n,i,o),this._finalizeParsing(),this.logging.enabled&&console.timeEnd("OBJLoader2Parser.executeLegacy")},_processLine:function(e,t,r,s,n){if(this.globalCounts.lineByte=this.globalCounts.currentByte,this.globalCounts.currentByte=n,!(t<1)){s.length>0&&(e[t++]=s);var o,i,a,l,u=function(e,t,r,s){var n="";if(s>r){var o;if(t)for(o=r;o<s;o++)n+=e[o];else for(o=r;o<s;o++)n+=String.fromCharCode(e[o]);n=n.trim()}return n};switch(l=e[0]){case"v":this.vertices.push(parseFloat(e[1])),this.vertices.push(parseFloat(e[2])),this.vertices.push(parseFloat(e[3])),t>4&&(this.colors.push(parseFloat(e[4])),this.colors.push(parseFloat(e[5])),this.colors.push(parseFloat(e[6])));break;case"vt":this.uvs.push(parseFloat(e[1])),this.uvs.push(parseFloat(e[2]));break;case"vn":this.normals.push(parseFloat(e[1])),this.normals.push(parseFloat(e[2])),this.normals.push(parseFloat(e[3]));break;case"f":if(o=t-1,0===r)for(this._checkFaceType(0),a=2,i=o;a<i;a++)this._buildFace(e[1]),this._buildFace(e[a]),this._buildFace(e[a+1]);else if(o===2*r)for(this._checkFaceType(1),a=3,i=o-2;a<i;a+=2)this._buildFace(e[1],e[2]),this._buildFace(e[a],e[a+1]),this._buildFace(e[a+2],e[a+3]);else if(2*o==3*r)for(this._checkFaceType(2),a=4,i=o-3;a<i;a+=3)this._buildFace(e[1],e[2],e[3]),this._buildFace(e[a],e[a+1],e[a+2]),this._buildFace(e[a+3],e[a+4],e[a+5]);else for(this._checkFaceType(3),a=3,i=o-2;a<i;a+=2)this._buildFace(e[1],void 0,e[2]),this._buildFace(e[a],void 0,e[a+1]),this._buildFace(e[a+2],void 0,e[a+3]);break;case"l":case"p":if((o=t-1)===2*r)for(this._checkFaceType(4),a=1,i=o+1;a<i;a+=2)this._buildFace(e[a],e[a+1]);else for(this._checkFaceType("l"===l?5:6),a=1,i=o+1;a<i;a++)this._buildFace(e[a]);break;case"s":this._pushSmoothingGroup(e[1]);break;case"g":this._processCompletedMesh(),this.rawMesh.groupName=u(this.contentRef,this.legacyMode,this.globalCounts.lineByte+2,this.globalCounts.currentByte);break;case"o":this.useOAsMesh&&this._processCompletedMesh(),this.rawMesh.objectName=u(this.contentRef,this.legacyMode,this.globalCounts.lineByte+2,this.globalCounts.currentByte);break;case"mtllib":this.rawMesh.mtllibName=u(this.contentRef,this.legacyMode,this.globalCounts.lineByte+7,this.globalCounts.currentByte);break;case"usemtl":var c=u(this.contentRef,this.legacyMode,this.globalCounts.lineByte+7,this.globalCounts.currentByte);""!==c&&this.rawMesh.activeMtlName!==c&&(this.rawMesh.activeMtlName=c,this.rawMesh.counts.mtlCount++,this._checkSubGroup())}}},_pushSmoothingGroup:function(e){var t=parseInt(e);isNaN(t)&&(t="off"===e?0:1);var r=this.rawMesh.smoothingGroup.normalized;this.rawMesh.smoothingGroup.normalized=this.rawMesh.smoothingGroup.splitMaterials?t:0===t?0:1,this.rawMesh.smoothingGroup.real=t,r!==t&&(this.rawMesh.counts.smoothingGroupCount++,this._checkSubGroup())},_checkFaceType:function(e){this.rawMesh.faceType!==e&&(this._processCompletedMesh(),this.rawMesh.faceType=e,this._checkSubGroup())},_checkSubGroup:function(){var e=this.rawMesh.activeMtlName+"|"+this.rawMesh.smoothingGroup.normalized;this.rawMesh.subGroupInUse=this.rawMesh.subGroups[e],void 0!==this.rawMesh.subGroupInUse&&null!==this.rawMesh.subGroupInUse||(this.rawMesh.subGroupInUse={index:e,objectName:this.rawMesh.objectName,groupName:this.rawMesh.groupName,materialName:this.rawMesh.activeMtlName,smoothingGroup:this.rawMesh.smoothingGroup.normalized,vertices:[],indexMappingsCount:0,indexMappings:[],indices:[],colors:[],uvs:[],normals:[]},this.rawMesh.subGroups[e]=this.rawMesh.subGroupInUse)},_buildFace:function(e,t,r){var s=this.rawMesh.subGroupInUse,n=this,o=function(){var o=parseInt(e),i=3*(o>0?o-1:o+n.vertices.length/3),a=n.colors.length>0?i:null,l=s.vertices;if(l.push(n.vertices[i++]),l.push(n.vertices[i++]),l.push(n.vertices[i]),null!==a){var u=s.colors;u.push(n.colors[a++]),u.push(n.colors[a++]),u.push(n.colors[a])}if(t){var c=parseInt(t),h=2*(c>0?c-1:c+n.uvs.length/2),d=s.uvs;d.push(n.uvs[h++]),d.push(n.uvs[h])}if(r&&!n.disregardNormals){var g=parseInt(r),p=3*(g>0?g-1:g+n.normals.length/3),m=s.normals;m.push(n.normals[p++]),m.push(n.normals[p++]),m.push(n.normals[p])}};if(this.useIndices){this.disregardNormals&&(r=void 0);var i=e+(t?"_"+t:"_n")+(r?"_"+r:"_n"),a=s.indexMappings[i];null==a?(a=this.rawMesh.subGroupInUse.vertices.length/3,o(),s.indexMappings[i]=a,s.indexMappingsCount++):this.rawMesh.counts.doubleIndicesCount++,s.indices.push(a)}else o();this.rawMesh.counts.faceCount++},_createRawMeshReport:function(e){return"Input Object number: "+e+"\n\tObject name: "+this.rawMesh.objectName+"\n\tGroup name: "+this.rawMesh.groupName+"\n\tMtllib name: "+this.rawMesh.mtllibName+"\n\tVertex count: "+this.vertices.length/3+"\n\tNormal count: "+this.normals.length/3+"\n\tUV count: "+this.uvs.length/2+"\n\tSmoothingGroup count: "+this.rawMesh.counts.smoothingGroupCount+"\n\tMaterial count: "+this.rawMesh.counts.mtlCount+"\n\tReal MeshOutputGroup count: "+this.rawMesh.subGroups.length},_finalizeRawMesh:function(){var e,t,r=[],s=0,n=0,o=0,i=0,a=0,l=0;for(var u in this.rawMesh.subGroups)if((e=this.rawMesh.subGroups[u]).vertices.length>0){if((t=e.indices).length>0&&n>0)for(var c=0;c<t.length;c++)t[c]=t[c]+n;r.push(e),s+=e.vertices.length,n+=e.indexMappingsCount,o+=e.indices.length,i+=e.colors.length,l+=e.uvs.length,a+=e.normals.length}var h=null;return r.length>0&&(h={name:""!==this.rawMesh.groupName?this.rawMesh.groupName:this.rawMesh.objectName,subGroups:r,absoluteVertexCount:s,absoluteIndexCount:o,absoluteColorCount:i,absoluteNormalCount:a,absoluteUvCount:l,faceCount:this.rawMesh.counts.faceCount,doubleIndicesCount:this.rawMesh.counts.doubleIndicesCount}),h},_processCompletedMesh:function(){var e=this._finalizeRawMesh(),t=null!==e;if(t){this.colors.length>0&&this.colors.length!==this.vertices.length&&this.callbacks.onError("Vertex Colors were detected, but vertex count and color count do not match!"),this.logging.enabled&&this.logging.debug&&console.debug(this._createRawMeshReport(this.inputObjectCount)),this.inputObjectCount++,this._buildMesh(e);var r=this.globalCounts.currentByte/this.globalCounts.totalBytes;this._onProgress("Completed [o: "+this.rawMesh.objectName+" g:"+this.rawMesh.groupName+"] Total progress: "+(100*r).toFixed(2)+"%"),this._resetRawMesh()}return t},_buildMesh:function(e){var t=e.subGroups,r=new Float32Array(e.absoluteVertexCount);this.globalCounts.vertices+=e.absoluteVertexCount/3,this.globalCounts.faces+=e.faceCount,this.globalCounts.doubleIndicesCount+=e.doubleIndicesCount;var s,n,o,i,a,l,u,c=e.absoluteIndexCount>0?new Uint32Array(e.absoluteIndexCount):null,h=e.absoluteColorCount>0?new Float32Array(e.absoluteColorCount):null,d=e.absoluteNormalCount>0?new Float32Array(e.absoluteNormalCount):null,g=e.absoluteUvCount>0?new Float32Array(e.absoluteUvCount):null,p=null!==h,m=[],f=t.length>1,b=0,v=[],k=[],w=0,y=0,M=0,C=0,A=0,O=0,_=0;for(var S in t)if(t.hasOwnProperty(S)){if(u=(s=t[S]).materialName,l=this.rawMesh.faceType<4?u+(p?"_vertexColor":"")+(0===s.smoothingGroup?"_flat":""):6===this.rawMesh.faceType?"defaultPointMaterial":"defaultLineMaterial",i=this.materials[u],a=this.materials[l],null==i&&null==a&&(l=p?"defaultVertexColorMaterial":"defaultMaterial",a=this.materials[l],this.logging.enabled&&console.info('object_group "'+s.objectName+"_"+s.groupName+'" was defined with unresolvable material "'+u+'"! Assigning "'+l+'".')),null==a){var N={materialNameOrg:u,materialName:l,materialProperties:{vertexColors:p?2:0,flatShading:0===s.smoothingGroup}},j={cmd:"assetAvailable",type:"material",materials:{materialCloneInstructions:N}};this.callbacks.onAssetAvailable(j);var L=this.materials[l];null==L&&(this.materials[l]=N)}if(f?((n=v[l])||(n=b,v[l]=b,m.push(l),b++),o={start:O,count:_=this.useIndices?s.indices.length:s.vertices.length/3,index:n},k.push(o),O+=_):m.push(l),r.set(s.vertices,w),w+=s.vertices.length,c&&(c.set(s.indices,y),y+=s.indices.length),h&&(h.set(s.colors,M),M+=s.colors.length),d&&(d.set(s.normals,C),C+=s.normals.length),g&&(g.set(s.uvs,A),A+=s.uvs.length),this.logging.enabled&&this.logging.debug){var W="";n&&(W="\n\t\tmaterialIndex: "+n);var P="\tOutput Object no.: "+this.outputObjectCount+"\n\t\tgroupName: "+s.groupName+"\n\t\tIndex: "+s.index+"\n\t\tfaceType: "+this.rawMesh.faceType+"\n\t\tmaterialName: "+s.materialName+"\n\t\tsmoothingGroup: "+s.smoothingGroup+W+"\n\t\tobjectName: "+s.objectName+"\n\t\t#vertices: "+s.vertices.length/3+"\n\t\t#indices: "+s.indices.length+"\n\t\t#colors: "+s.colors.length/3+"\n\t\t#uvs: "+s.uvs.length/2+"\n\t\t#normals: "+s.normals.length/3;console.debug(P)}}this.outputObjectCount++,this.callbacks.onAssetAvailable({cmd:"assetAvailable",type:"mesh",progress:{numericalValue:this.globalCounts.currentByte/this.globalCounts.totalBytes},params:{meshName:e.name},materials:{multiMaterial:f,materialNames:m,materialGroups:k},buffers:{vertices:r,indices:c,colors:h,normals:d,uvs:g},geometryType:this.rawMesh.faceType<4?0:6===this.rawMesh.faceType?2:1},[r.buffer],null!==c?[c.buffer]:null,null!==h?[h.buffer]:null,null!==d?[d.buffer]:null,null!==g?[g.buffer]:null)},_finalizeParsing:function(){if(this.logging.enabled&&console.info("Global output object count: "+this.outputObjectCount),this._processCompletedMesh()&&this.logging.enabled){var e="Overall counts: \n\tVertices: "+this.globalCounts.vertices+"\n\tFaces: "+this.globalCounts.faces+"\n\tMultiple definitions: "+this.globalCounts.doubleIndicesCount;console.info(e)}}};var m=function(e){this.logging={enabled:!1,debug:!1},this.callbacks={onProgress:null,onMeshAlter:null},this.materialHandler=e};m.prototype={constructor:m,setLogging:function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},_setCallbacks:function(e,t){null!=e&&e instanceof Function&&(this.callbacks.onProgress=e),null!=t&&t instanceof Function&&(this.callbacks.onMeshAlter=t)},buildMeshes:function(t){var r,s,n,o=t.params.meshName,i=t.buffers,a=new e.BufferGeometry;void 0!==i.vertices&&null!==i.vertices&&a.setAttribute("position",new e.BufferAttribute(new Float32Array(i.vertices),3)),void 0!==i.indices&&null!==i.indices&&a.setIndex(new e.BufferAttribute(new Uint32Array(i.indices),1)),void 0!==i.colors&&null!==i.colors&&a.setAttribute("color",new e.BufferAttribute(new Float32Array(i.colors),3)),void 0!==i.normals&&null!==i.normals?a.setAttribute("normal",new e.BufferAttribute(new Float32Array(i.normals),3)):a.computeVertexNormals(),void 0!==i.uvs&&null!==i.uvs&&a.setAttribute("uv",new e.BufferAttribute(new Float32Array(i.uvs),2)),void 0!==i.skinIndex&&null!==i.skinIndex&&a.setAttribute("skinIndex",new e.BufferAttribute(new Uint16Array(i.skinIndex),4)),void 0!==i.skinWeight&&null!==i.skinWeight&&a.setAttribute("skinWeight",new e.BufferAttribute(new Float32Array(i.skinWeight),4));var l=t.materials.materialNames,u=t.materials.multiMaterial,c=[];for(n in l)s=l[n],r=this.materialHandler.getMaterial(s),u&&c.push(r);if(u){r=c;var h,d=t.materials.materialGroups;for(n in d)h=d[n],a.addGroup(h.start,h.count,h.index)}var g,p,m=[],f=!0,b=null===t.geometryType?0:t.geometryType;if(this.callbacks.onMeshAlter&&(p=this.callbacks.onMeshAlter({detail:{meshName:o,bufferGeometry:a,material:r,geometryType:b}})),p)if(p.isDisregardMesh())f=!1;else if(p.providesAlteredMeshes()){for(var v in p.meshes)m.push(p.meshes[v]);f=!1}f&&(t.computeBoundingSphere&&a.computeBoundingSphere(),(g=0===b?new e.Mesh(a,r):1===b?new e.LineSegments(a,r):new e.Points(a,r)).name=o,m.push(g));var k=t.params.meshName;if(m.length>0){var w=[];for(var y in m)g=m[y],w[y]=g.name;k+=": Adding mesh(es) ("+w.length+": "+w+") from input mesh: "+o,k+=" ("+(100*t.progress.numericalValue).toFixed(2)+"%)"}else k+=": Not adding mesh: "+o,k+=" ("+(100*t.progress.numericalValue).toFixed(2)+"%)";return this.callbacks.onProgress&&this.callbacks.onProgress("progress",k,t.progress.numericalValue),m}};var f=function(){this.logging={enabled:!1,debug:!1},this.callbacks={onLoadMaterials:null},this.materials={}};f.prototype={constructor:f,setLogging:function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},_setCallbacks:function(e){null!=e&&e instanceof Function&&(this.callbacks.onLoadMaterials=e)},createDefaultMaterials:function(t){var r=new e.MeshStandardMaterial({color:14479871});r.name="defaultMaterial";var s=new e.MeshStandardMaterial({color:14479871});s.name="defaultVertexColorMaterial",s.vertexColors=!0;var n=new e.LineBasicMaterial;n.name="defaultLineMaterial";var o=new e.PointsMaterial({size:.1});o.name="defaultPointMaterial";var i={};i[r.name]=r,i[s.name]=s,i[n.name]=n,i[o.name]=o,this.addMaterials(i,t)},addPayloadMaterials:function(t){var r,s,n=t.materials.materialCloneInstructions,o={};if(null!=n){var i=n.materialNameOrg;i=null!=i?i:"";var a=this.materials[i];a?(r=a.clone(),s=n.materialName,r.name=s,Object.assign(r,n.materialProperties),this.materials[s]=r,o[s]=r):this.logging.enabled&&console.info('Requested material "'+i+'" is not available!')}var l=t.materials.serializedMaterials;if(null!=l&&Object.keys(l).length>0){var u,c=new e.MaterialLoader;for(s in l)null!=(u=l[s])&&(r=c.parse(u),this.logging.enabled&&console.info('De-serialized material with name "'+s+'" will be added.'),this.materials[s]=r,o[s]=r)}return l=t.materials.runtimeMaterials,o=this.addMaterials(l,!0,o)},addMaterials:function(e,t,r){var s,n;if(null==r&&(r={}),null!=e&&Object.keys(e).length>0)for(var o in e)s=e[o],(n=!0===t)||(n=null==this.materials[o]),n&&(this.materials[o]=s,r[o]=s),this.logging.enabled&&this.logging.debug&&console.info('Material with name "'+o+'" was added.');return this.callbacks.onLoadMaterials&&this.callbacks.onLoadMaterials(r),r},getMaterials:function(){return this.materials},getMaterial:function(e){return this.materials[e]},getMaterialsJSON:function(){var e,t={};for(var r in this.materials)e=this.materials[r],t[r]=e.toJSON();return t},clearMaterials:function(){this.materials={}}};var b=function(t){e.Loader.call(this,t),this.parser=new p,this.modelName="",this.instanceNo=0,this.baseObject3d=new e.Object3D,this.materialHandler=new f,this.meshReceiver=new m(this.materialHandler);var r=this;this.parser.setCallbackOnAssetAvailable((function(e){r._onAssetAvailable(e)}))};b.OBJLOADER2_VERSION="3.2.0",console.info("Using OBJLoader2 version: "+b.OBJLOADER2_VERSION),b.prototype=Object.assign(Object.create(e.Loader.prototype),{constructor:b,setLogging:function(e,t){return this.parser.setLogging(e,t),this},setMaterialPerSmoothingGroup:function(e){return this.parser.setMaterialPerSmoothingGroup(e),this},setUseOAsMesh:function(e){return this.parser.setUseOAsMesh(e),this},setUseIndices:function(e){return this.parser.setUseIndices(e),this},setDisregardNormals:function(e){return this.parser.setDisregardNormals(e),this},setModelName:function(e){return this.modelName=e||this.modelName,this},setBaseObject3d:function(e){return this.baseObject3d=null==e?this.baseObject3d:e,this},addMaterials:function(e,t){return this.materialHandler.addMaterials(e,t),this},setCallbackOnAssetAvailable:function(e){return this.parser.setCallbackOnAssetAvailable(e),this},setCallbackOnProgress:function(e){return this.parser.setCallbackOnProgress(e),this},setCallbackOnError:function(e){return this.parser.setCallbackOnError(e),this},setCallbackOnLoad:function(e){return this.parser.setCallbackOnLoad(e),this},setCallbackOnMeshAlter:function(e){return this.meshReceiver._setCallbacks(this.parser.callbacks.onProgress,e),this},setCallbackOnLoadMaterials:function(e){return this.materialHandler._setCallbacks(e),this},load:function(t,r,s,n,o){var i=this;if(!(null!=r&&r instanceof Function)){var a="onLoad is not a function! Aborting...";throw i.parser.callbacks.onError(a),a}this.parser.setCallbackOnLoad(r),null!=n&&n instanceof Function||(n=function(e){var t=e;e.currentTarget&&null!==e.currentTarget.statusText&&(t="Error occurred while downloading!\nurl: "+e.currentTarget.responseURL+"\nstatus: "+e.currentTarget.statusText),i.parser.callbacks.onError(t)}),t||n("An invalid url was provided. Unable to continue!");var l=new URL(t,window.location.href).href,u=l,c=l.split("/");if(c.length>2&&(u=c[c.length-1],this.path=c.slice(0,c.length-1).join("/")+"/"),null==s||!(s instanceof Function)){var h=0,d=0;s=function(e){if(e.lengthComputable&&(d=e.loaded/e.total)>h){h=d;var r='Download of "'+t+'": '+(100*d).toFixed(2)+"%";i.parser.callbacks.onProgress("progressLoad",r,d)}}}this.setCallbackOnMeshAlter(o);var g=new e.FileLoader(this.manager);g.setPath(this.path||this.resourcePath),g.setResponseType("arraybuffer"),g.load(u,(function(e){i.parser.callbacks.onLoad(i.parse(e),"OBJLoader2#load: Parsing completed")}),s,n)},parse:function(e){if(null==e)throw"Provided content is not a valid ArrayBuffer or String. Unable to continue parsing";return this.parser.logging.enabled&&console.time("OBJLoader parse: "+this.modelName),this.materialHandler.createDefaultMaterials(!1),this.parser.setMaterials(this.materialHandler.getMaterials()),e instanceof ArrayBuffer||e instanceof Uint8Array?(this.parser.logging.enabled&&console.info("Parsing arrayBuffer..."),this.parser.execute(e)):"string"==typeof e||e instanceof String?(this.parser.logging.enabled&&console.info("Parsing text..."),this.parser.executeLegacy(e)):this.parser.callbacks.onError("Provided content was neither of type String nor Uint8Array! Aborting..."),this.parser.logging.enabled&&console.timeEnd("OBJLoader parse: "+this.modelName),this.baseObject3d},_onAssetAvailable:function(e){if("assetAvailable"===e.cmd)if("mesh"===e.type){var t,r=function(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=c(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var s=0,n=function(){};return{s:n,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,a=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return i=e.done,e},e:function(e){a=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(a)throw o}}}}(this.meshReceiver.buildMeshes(e));try{for(r.s();!(t=r.n()).done;){var s=t.value;this.baseObject3d.add(s)}}catch(e){r.e(e)}finally{r.f()}}else"material"===e.type&&this.materialHandler.addPayloadMaterials(e)}});var ObjectManipulator=function(){};ObjectManipulator.prototype={constructor:ObjectManipulator,applyProperties:function(e,t,r){var s,n,o;if(null!=e&&null!=t)for(s in t)n="set"+s.substring(0,1).toLocaleUpperCase()+s.substring(1),o=t[s],"function"==typeof e[n]?e[n](o):(e.hasOwnProperty(s)||r)&&(e[s]=o)}};var v=function(e){this.parser=e,this.logging={enabled:!1,debug:!1}};v.prototype={constructor:v,handlePayload:function(e){if(e.logging&&(this.logging.enabled=!0===e.logging.enabled,this.logging.debug=!0===e.logging.debug),"parse"===e.cmd){var t=this,r={callbackOnAssetAvailable:function(e){self.postMessage(e)},callbackOnProgress:function(e){t.logging.enabled&&t.logging.debug&&console.debug("WorkerRunner: progress: "+e)}},s=this.parser;"function"==typeof s.setLogging&&s.setLogging(this.logging.enabled,this.logging.debug);var n=new ObjectManipulator;n.applyProperties(s,e.params,!1),n.applyProperties(s,r,!1);var o=e.data.input,i="execute";"function"==typeof s.getParseFunctionName&&(i=s.getParseFunctionName()),e.usesMeshDisassembler||s[i](o,e.data.options),this.logging.enabled&&console.log("WorkerRunner: Run complete!"),self.postMessage({cmd:"completeOverall",msg:"WorkerRunner completed run."})}else console.error("WorkerRunner: Received unknown command: "+e.cmd)}};var k=function(e){this.payloadHandler=e;var t=this;self.addEventListener("message",(function(e){t.processMessage(e.data)}),!1)};k.prototype={constructor:k,processMessage:function(e){this.payloadHandler.handlePayload(e)}};var w=function(e){b.call(this,e),this.preferJsmWorker=!1,this.jsmWorkerUrl=null,this.executeParallel=!0,this.workerExecutionSupport=new s};w.OBJLOADER2_PARALLEL_VERSION="3.2.0",console.info("Using OBJLoader2Parallel version: "+w.OBJLOADER2_PARALLEL_VERSION),w.DEFAULT_JSM_WORKER_PATH="./jsm/loaders/obj2/worker/parallel/OBJLoader2JsmWorker.js",w.prototype=Object.assign(Object.create(b.prototype),{constructor:w,setExecuteParallel:function(e){return this.executeParallel=!0===e,this},setJsmWorker:function(e,t){if(this.preferJsmWorker=!0===e,null==t)throw"The url to the jsm worker is not valid. Aborting...";return this.jsmWorkerUrl=t,this},getWorkerExecutionSupport:function(){return this.workerExecutionSupport},buildWorkerCode:function(){var e=new r(!0,!0,this.preferJsmWorker);if(e.isSupportsJsmWorker()&&e.setJsmWorkerUrl(this.jsmWorkerUrl),e.isSupportsStandardWorker()){var t=new ObjectManipulator,s=new v(this.parser),n=new k({});e.addCodeFragment(d(p,this.parser)),e.addCodeFragment(d(ObjectManipulator,t)),e.addCodeFragment(d(v,s)),e.addCodeFragment(d(k,n));var o="new "+n.constructor.name+"( new "+s.constructor.name+"( new "+this.parser.constructor.name+"() ) );";e.addStartCode(o)}return e},load:function(e,t,r,s,n){var o=this;b.prototype.load.call(this,e,(function(e,r){"OBJLoader2ParallelDummy"===e.name?o.parser.logging.enabled&&o.parser.logging.debug&&console.debug("Received dummy answer from OBJLoader2Parallel#parse"):t(e,r)}),r,s,n)},parse:function(t){if(this.executeParallel){if(this.parser.callbacks.onLoad===this.parser._onLoad)throw"No callback other than the default callback was provided! Aborting!";if(!this.workerExecutionSupport.isWorkerLoaded(this.preferJsmWorker)){this.workerExecutionSupport.buildWorker(this.buildWorkerCode());var r=this;this.workerExecutionSupport.updateCallbacks((function(e){r._onAssetAvailable(e)}),(function(e){r.parser.callbacks.onLoad(r.baseObject3d,e)}))}this.materialHandler.createDefaultMaterials(!1),this.workerExecutionSupport.executeParallel({params:{modelName:this.modelName,instanceNo:this.instanceNo,useIndices:this.parser.useIndices,disregardNormals:this.parser.disregardNormals,materialPerSmoothingGroup:this.parser.materialPerSmoothingGroup,useOAsMesh:this.parser.useOAsMesh,materials:this.materialHandler.getMaterialsJSON()},data:{input:t,options:null},logging:{enabled:this.parser.logging.enabled,debug:this.parser.logging.debug}});var s=new e.Object3D;return s.name="OBJLoader2ParallelDummy",s}return b.prototype.parse.call(this,t)}});var y=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.listeners=t?t.listeners:[],this.inst=r||function(){}}var t,r,s;return t=e,(r=[{key:"listen",value:function(e){this.listeners.includes(e)||this.listeners.push(e)}},{key:"unlisten",value:function(e){var t=this.listeners.indexOf(e);t>=0&&this.listeners.splice(t,1)}},{key:"emit",value:function(){this.listeners.forEach((function(e){return e()}))}}])&&o(t.prototype,r),s&&o(t,s),e}();function M(e){if(e.isVector3)return e;var r=Array.isArray(e)?e:e.trim().split(/\s+/);return l(t.Vector3,u(r.map(parseFloat)))}function C(e){if(e.isEuler)return e;var r=Array.isArray(e)?e:e.trim().split(/\s+/);return l(t.Euler,u(r.slice(0,3).map(parseFloat)).concat([r[3]]))}function A(e){if(e.isQuaternion)return e;var r=Array.isArray(e)?e:e.trim().split(/\s+/);return l(t.Quaternion,u(r.map(parseFloat)))}var O=Boolean,_=String,S=String,N=[String,t.Vector3];function j(e){return!Number.isNaN(parseFloat(e))}function L(e){if(e instanceof t.Vector3)return!0;var r=Array.isArray(e)?e:e.trim().split(/\s+/);return 3===r.length&&r.every(j)}return{mixins:[{props:{position:{type:N,validator:L},rotation:{type:[String,t.Euler],validator:function(e){if(e instanceof t.Euler)return!0;var r=Array.isArray(e)?e:e.trim().split(/\s+/);return 4===r.length&&r.slice(0,3).every(j)&&/[XYZ]{3}/.test(r[3])}},rotationQuaternion:{type:[String,t.Quaternion],validator:function(e){if(e instanceof t.Quaternion)return!0;var r=Array.isArray(e)?e:e.trim().split(/\s+/);return 4===r.length&&r.every(j)}},scale:{type:N,validator:L},castShadow:O,receiveShadow:O,name:{type:S,validator:function(e){return/^\s*\S+\s*$/.test(e)}},hidden:O},inject:{vglObject3d:{default:function(){return new y}},vglNamespace:{default:function(){throw new Error("VueGL components must be wraped by VglNamespace component.")}}},provide:function(){var e=this;return{vglObject3d:new y(this.vglObject3d,(function(){return e.inst}))}},computed:{inst:function(){return new t.Object3D},parent:function(){return this.vglObject3d.inst()}},methods:{emitAsObject3d:function(){this.vglNamespace.object3ds.emit(this.name,this.inst)}},beforeDestroy:function(){this.inst.parent&&this.inst.parent.remove(this.inst),void 0!==this.name&&(this.vglObject3d.unlisten(this.emitAsObject3d),this.vglNamespace.object3ds.delete(this.name,this.inst))},watch:{inst:{handler:function(e,t){t&&t.parent&&t.parent.remove(t),this.parent&&this.parent.add(e),this.position&&e.position.copy(M(this.position)),this.rotation&&e.rotation.copy(C(this.rotation)),this.rotationQuaternion&&e.quaternion.copy(A(this.rotationQuaternion)),this.scale&&e.scale.copy(M(this.scale)),Object.assign(e,{castShadow:this.castShadow,receiveShadow:this.receiveShadow,visible:!this.hidden,name:this.name}),void 0!==this.name&&this.vglNamespace.object3ds.set(this.name,e),t&&this.vglObject3d.emit()},immediate:!0},parent:function(e){e.add(this.inst)},name:[function(e){this.inst.name=e},{handler:function(e,t){void 0!==t&&(this.vglNamespace.object3ds.delete(t,this.inst),void 0===e&&this.vglObject3d.unlisten(this.emitAsObject3d)),void 0!==e&&(this.vglNamespace.object3ds.set(e,this.inst),void 0===t&&this.vglObject3d.listen(this.emitAsObject3d))},immediate:!0}],position:function(e){this.inst.position.copy(M(e)),this.vglObject3d.emit()},rotation:function(e){this.inst.rotation.copy(C(e)),this.vglObject3d.emit()},rotationQuaternion:function(e){this.inst.quaternion.copy(A(e)),this.vglObject3d.emit()},scale:function(e){this.inst.scale.copy(M(e)),this.vglObject3d.emit()},castShadow:function(e){this.inst.castShadow=e,this.vglObject3d.emit()},receiveShadow:function(e){this.inst.receiveShadow=e,this.vglObject3d.emit()},hidden:function(e){this.inst.visible=!e,this.vglObject3d.emit()}},render:function(e){if(this.$slots.default)return e("div",{style:{display:"none"}},this.$slots.default)}}],props:{src:_},computed:{inst:function(){var e=this,r=new t.Object3D,s=new w;return s.setBaseObject3d(r),s.load(this.src,(function(){e.vglObject3d.emit()})),r}}}}));
